<!-- Email warning bar -->
<div id="email-warning-bar" class="hidden bg-yellow-400 text-yellow-900 text-center text-sm py-1 w-full">
  <span><i class="fas fa-exclamation-triangle mr-2"></i>Seu e-mail ainda não foi confirmado. Confirme seu e-mail para finalizar suas compras.</span>
</div>

<!-- Main Header (Desktop) -->
<header class="bg-white shadow-md sticky top-0 z-50 hidden md:block">
  <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row items-center justify-between">
    <!-- Logo and Name -->
    <div class="flex items-center">
      <a href="index.html" class="focus:outline-none">
        <img src="img/logo.png" width="75" height="75" alt="Home" />
      </a>
      <div class="ml-2.5">
        <span class="text-2xl font-bold text-blue-900">Farmácia São Benedito</span>
      </div>
    </div>
    
    <!-- Search Bar -->
    <div class="relative w-full md:w-1/3 mx-auto my-4 md:my-0">
      <form id="header-search-form" class="relative">
        <input type="text" id="header-search-input" placeholder="Buscar medicamentos..." 
               class="w-full px-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <button type="submit" class="absolute right-0 top-0 h-full px-4 text-white bg-blue-700 rounded-r-full hover:bg-blue-800">
          <i class="fas fa-search"></i>
        </button>
      </form>
    </div>
    
    <!-- Auth and Cart -->
    <div class="flex items-center space-x-6">
      <div id="authContainerSecondary" class="text-center relative"></div>
      <div class="text-center relative group">
        <a href="./carrinho.html" id="cart-icon" class="text-gray-700 hover:text-blue-700">
          <i class="fas fa-shopping-cart text-xl"></i>
          <p class="text-xs">Carrinho</p>
          <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
        </a>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="bg-blue-800 text-white">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-center items-center">
        <div class="hidden md:flex space-x-1">
          <a href="./index.html" class="nav-link py-3 px-4 hover:bg-blue-900">Produtos</a>
          <a href="./ofertas.html" class="nav-link py-3 px-4 hover:bg-blue-900">Ofertas</a>
          <a href="./sobre.html" class="nav-link py-3 px-4 hover:bg-blue-900">Sobre Nós</a>
          <a href="./contato.html" class="nav-link py-3 px-4 hover:bg-blue-900">Contato</a>
        </div>
      </div>
    </div>
  </nav>
</header>

<!-- Mobile Topbar -->
<div id="topbar-fixed" x-data="{ mobileMenuOpen: false }"
     class="fixed top-0 left-0 right-0 z-50 bg-white shadow flex items-center px-2 py-2 md:hidden">
  <button @click="mobileMenuOpen = true; window.dispatchEvent(new Event('mobileMenuOpened'))" 
          class="text-blue-900 text-2xl focus:outline-none mr-2 flex-shrink-0 md:mr-4">
    <i class="fas fa-bars"></i>
  </button>
  
  <form class="flex-1 flex justify-center" id="header-search-form">
    <div class="relative w-full max-w-lg">
      <input type="text" id="header-search-input" placeholder="Buscar medicamentos..." 
             class="w-full px-4 py-2 rounded-full border border-gray-300 text-base focus:outline-none focus:ring-2 focus:ring-blue-500" />
      <button type="submit" class="absolute right-0 top-0 h-full px-4 text-white bg-blue-700 rounded-r-full hover:bg-blue-800 text-base">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </form>
  
  <div class="flex items-center ml-2">
    <div id="authContainerSecondary" class="text-center relative"></div>
    <a href="./carrinho.html" id="cart-icon" class="ml-4 text-gray-700 hover:text-blue-700 relative">
      <i class="fas fa-shopping-cart text-xl"></i>
      <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
    </a>
  </div>
  
  <!-- Mobile Menu Overlay -->
  <div x-show="mobileMenuOpen" @click="mobileMenuOpen = false" 
       class="fixed inset-0 bg-black bg-opacity-50 z-50 transition-opacity duration-200" 
       x-transition.opacity x-cloak style="display: none;"></div>
  
  <!-- Mobile Menu Sidebar -->
  <aside x-show="mobileMenuOpen" @keydown.escape.window="mobileMenuOpen = false" 
         class="fixed top-0 left-0 h-full w-64 bg-white shadow-lg z-50 transform transition-transform duration-200 overflow-y-auto" 
         x-transition:enter="transition transform duration-200" 
         x-transition:enter-start="-translate-x-full" 
         x-transition:enter-end="translate-x-0" 
         x-transition:leave="transition transform duration-200" 
         x-transition:leave-start="translate-x-0" 
         x-transition:leave-end="-translate-x-full" 
         x-cloak tabindex="-1" style="display: none;">
    <div class="flex items-center justify-between px-4 py-4 border-b">
      <span class="font-bold text-blue-900 text-lg">Menu</span>
      <button @click="mobileMenuOpen = false" class="text-gray-700 text-2xl focus:outline-none">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div id="authContainerSecondaryMobileMenu" class="px-6 py-2 border-b"></div>
    
    <nav class="flex flex-col mt-2">
      <a href="#" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" id="aside-todos-mobile" @click="mobileMenuOpen = false">Todos os Produtos</a>
      <a href="#" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" data-categoria="Referência" @click="mobileMenuOpen = false">Referência</a>
      <a href="#" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" data-categoria="Similares" @click="mobileMenuOpen = false">Similares</a>
      <a href="#" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" data-categoria="Genéricos" @click="mobileMenuOpen = false">Genéricos</a>
      <a href="#" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" data-categoria="Perfumaria" @click="mobileMenuOpen = false">Perfumaria</a>
      <a href="#" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" data-categoria="Suplementos" @click="mobileMenuOpen = false">Vitaminas</a>
      <a href="#" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" data-categoria="Hospitalar" @click="mobileMenuOpen = false">Hospitalar</a>
      <hr class="my-2">
      <a href="./ofertas.html" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" @click="mobileMenuOpen = false">Ofertas</a>
      <a href="./sobre.html" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" @click="mobileMenuOpen = false">Sobre Nós</a>
      <a href="./contato.html" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" @click="mobileMenuOpen = false">Contato</a>
      <hr class="my-2">
      <a href="./minha-conta.html" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" @click="mobileMenuOpen = false">Minha Conta</a>
      <a href="./endereco-entrega.html" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" @click="mobileMenuOpen = false">Endereços de Entrega</a>
      <a href="./pedidos.html" class="py-3 px-6 hover:bg-blue-100 text-blue-900 font-medium" @click="mobileMenuOpen = false">Pedidos</a>
    </nav>
  </aside>
</div>

<!-- Mobile topbar spacer -->
<div id="topbar-spacer" class="h-16" style="display:none"></div>

<script>
// Topbar visibility management
function updateTopbarVisibility() {
  const topbar = document.getElementById('topbar-fixed');
  const spacer = document.getElementById('topbar-spacer');
  if (!topbar || !spacer) return;
  
  topbar.classList.remove('hidden');
  topbar.style.removeProperty('display');
  
  const isMobile = window.matchMedia('(max-width: 767px)').matches;
  if (isMobile) {
    topbar.style.display = 'flex';
    spacer.style.display = 'block';
    topbar.removeAttribute('hidden');
    topbar.removeAttribute('aria-hidden');
  } else {
    topbar.style.display = 'none';
    spacer.style.display = 'none';
  }
}

window.addEventListener('resize', updateTopbarVisibility);
window.addEventListener('orientationchange', updateTopbarVisibility);
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(updateTopbarVisibility, 0);
  setTimeout(updateTopbarVisibility, 300);
});

// Header search integration
(function() {
  function handleHeaderSearchSubmit(e) {
    e.preventDefault();
    var input = this.querySelector('#header-search-input');
    if (input) {
      var searchValue = input.value.trim();
      if (searchValue.length > 0) {
        window.dispatchEvent(new CustomEvent('headerSearch', { detail: searchValue }));
      }
    }
  }
  
  var forms = document.querySelectorAll('#header-search-form');
  forms.forEach(function(form) {
    form.addEventListener('submit', handleHeaderSearchSubmit);
  });
})();

// Global logout function
window.handleLogout = async function(options = {}) {
  if (window.auth && window.auth.signOut) {
    try {
      await window.auth.signOut();
    } catch (err) {
      console.error('Erro ao sair:', err);
    }
  }
  
  // Close mobile menu if open
  const topbar = document.querySelector('#topbar-fixed');
  if (topbar && topbar.__x && topbar.__x.$data) {
    topbar.__x.$data.mobileMenuOpen = false;
  }
  
  if (options.reload !== false) {
    window.location.reload();
  }
};
</script>